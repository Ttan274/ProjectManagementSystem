<div class="git-analysis-section">
    <h4 class="section-title mt-3 d-flex justify-content-between align-items-center">
        <span><i class="bi bi-git"></i> Git Commit Analysis</span>
        <i class="bi bi-question-circle-fill text-secondary fs-6" data-bs-toggle="tooltip" data-bs-original-title="Git commit analysis to track and analyze commit trends, activity, and risks."></i>
        <select class="form-select w-auto ms-3" id="app-selector"></select>
    </h4>

    <div class="row">
        <!-- Overview Metrics -->
        <div class="col-md-6 mb-4">
            <div class="metric-card h-100">
                <div class="metric-header">
                    <i class="bi bi-file-earmark-bar-graph-fill icon-primary"></i>
                    <h5>Overview <i class="bi bi-question-circle-fill text-secondary fs-6" data-bs-toggle="tooltip" data-bs-original-title="Overview of the git commit activity like total commits, average commit size, and code growth."></i></h5>
                </div>
                <div class="row">
                    <div class="col-6">
                        <div class="metric-value text-primary" id="total-commits">--</div>
                        <div class="metric-description">Total Commits</div>
                    </div>
                    <div class="col-6">
                        <div class="metric-value text-info" id="avg-commit-size">--</div>
                        <div class="metric-description">Avg. Commit Size</div>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-6">
                        <div class="metric-value text-success" id="feature-commits">--</div>
                        <div class="metric-description">Feature Commits</div>
                    </div>
                    <div class="col-6">
                        <div class="metric-value text-warning" id="refactor-commits">--</div>
                        <div class="metric-description">Refactor Commits</div>
                    </div>
                </div>
                <div class="mt-3">
                    <div class="progress-label">
                        <span>Code Growth</span>
                        <span id="net-growth">--</span>
                    </div>
                    <div class="progress">
                        <div class="progress-bar bg-success" role="progressbar" id="net-growth-bar" style="width: 50%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Team Activity -->
        <div class="col-md-6 mb-4">
            <div class="metric-card h-100">
                <div class="metric-header">
                    <i class="bi bi-people-fill icon-info"></i>
                    <h5>Team Activity <i class="bi bi-question-circle-fill text-secondary fs-6" data-bs-toggle="tooltip" data-bs-original-title="Analyzes team activity and tracks the most active developer."></i></h5>
                </div>
                <div class="chart-container-sm">
                    <canvas id="team-activity-chart"></canvas>
                </div>
                <div class="mt-2 text-center small">
                    <span class="badge bg-primary me-2" id="top-committer">--</span>
                    <span>most active developer</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row">
        <!-- Activity Trend -->
        <div class="col-md-6 mb-4">
            <div class="metric-card h-100">
                <div class="metric-header">
                    <i class="bi bi-calendar-week icon-success"></i>
                    <h5>Activity Trend <i class="bi bi-question-circle-fill text-secondary fs-6" data-bs-toggle="tooltip" data-bs-original-title="Shows the trend of commits over time."></i></h5>
                </div>
                <div class="chart-container">
                    <canvas id="activity-trend-chart"></canvas>
                </div>
            </div>
        </div>

        <!-- Commit Patterns -->
        <div class="col-md-6 mb-4">
            <div class="metric-card h-100">
                <div class="metric-header">
                    <i class="bi bi-clock-history icon-warning"></i>
                    <h5>Commit Times <i class="bi bi-question-circle-fill text-secondary fs-6" data-bs-toggle="tooltip" data-bs-original-title="Shows commit patterns such as the times and days commits are most frequent."></i></h5>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="chart-container-sm">
                            <canvas id="commits-by-hour-chart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="chart-container-sm">
                            <canvas id="commits-by-day-chart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="mt-2 small text-center">
                    <span id="busy-period-info" class="text-muted"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Risk Analysis -->
    <div class="row">
        <div class="col-12">
            <div class="metric-card">
                <div class="metric-header">
                    <i class="bi bi-exclamation-triangle-fill icon-danger"></i>
                    <h5>Risk Analysis <i class="bi bi-question-circle-fill text-secondary fs-6" data-bs-toggle="tooltip" data-bs-original-title="Analyzes risky commits, like high-risk commits and deadline rushes."></i></h5>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="metric-value text-danger" id="high-risk-commits">--</div>
                        <div class="metric-description">High-Risk Commits</div>
                    </div>
                    <div class="col-md-4">
                        <div class="metric-value" id="single-author-files">--</div>
                        <div class="metric-description">Single Author Files</div>
                    </div>
                    <div class="col-md-4">
                        <div class="metric-value text-warning" id="deadline-rushes">--</div>
                        <div class="metric-description">Friday Commits</div>
                    </div>
                </div>
                <div class="mt-3">
                    <div class="alert alert-warning py-2 mb-0" id="risk-files-alert">
                        <i class="bi bi-info-circle me-2"></i>
                        <span id="risk-files-info">Risky files are loading...</span>
                    </div>
                </div>

                <!-- Commit DataTable -->
                <div class="mt-4 table-responsive">
                    <h5>Commit Analysis</h5>
                    <table id="commit-table" class="table table-striped table-bordered">
                        <thead>
                            <tr>
                                <th>Author</th>
                                <th>Date</th>
                                <th>Files Changed</th>
                                <th>Risk Reason</th>
                                <th>Commit Message</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12">
            <div class="metric-card">
                <div class="metric-header">
                    <i class="bi bi-person-lines-fill icon-primary"></i>
                    <h5>Developer Statistics <i class="bi bi-question-circle-fill text-secondary fs-6" data-bs-toggle="tooltip" data-bs-original-title="Shows developer statistics, such as commit counts, additions, deletions, and more."></i></h5>
                </div>
                <div class="table-responsive">
                    <table class="table table-sm align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>User</th>
                                <th>Commit</th>
                                <th>+ Additions</th>
                                <th>- Deletions</th>
                                <th>Refactor</th>
                                <th>Net Change</th>
                                <th>Score</th>
                            </tr>
                        </thead>
                        <tbody id="top-devs-table-body">
                            <tr><td colspan="7" class="text-center">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="row mt-4">
        <div class="col-12">
            <div class="metric-card">
                <div class="metric-header">
                    <i class="bi bi-git pull icon-info"></i>
                    <h5>Pull Request Analysis <i class="bi bi-question-circle-fill text-secondary fs-6" data-bs-toggle="tooltip" data-bs-original-title="Tracks pull request analysis, including the total PRs, average close time, and slowest closed PR."></i></h5>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="metric-value text-primary" id="total-prs">--</div>
                        <div class="metric-description">Total Pull Requests</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="metric-value text-success" id="avg-pr-close-time">--</div>
                        <div class="metric-description">Avg. Close Time</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="metric-value text-warning" id="slowest-closed-pr">--</div>
                        <div class="metric-description">Slowest Closed PR</div>
                        <div class="small text-muted" id="slowest-pr-user">Loading...</div>
                    </div>
                </div>
                <div class="mt-3">
                    <div class="pr-chart-container">
                        <canvas id="pr-trend-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<style>
    .git-analysis-section {
        padding: 15px;
    }

    .chart-container {
        height: 250px;
        position: relative;
    }

    .chart-container-sm {
        height: 180px;
        position: relative;
    }

    .metric-card {
        background-color: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        border: 1px solid #e0e0e0;
    }

    .risk-file-badge {
        font-size: 0.8rem;
        margin-right: 5px;
        margin-bottom: 5px;
    }

    #top-devs-table-body td,
    #top-devs-table-body th {
        padding: 0.4rem 0.6rem;
    }

    #top-devs-table-body {
        font-size: 0.9rem;
    }

    .pr-chart-container {
        width: 100%;
        height: 400px;
        max-width: 90%;
        margin: 0 auto;
        padding: 15px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #pr-trend-chart {
        width: 100% !important;
        height: 100% !important;
    }
</style>

<script>
    $(document).ready(function() {
        $('[data-bs-toggle="tooltip"]').tooltip();

        appSelector = $('#app-selector');

        appSelector.on('change', function() {
            const selectedAppId = $(this).val();
            if (selectedAppId) {
                fetchGitCommitStats(selectedAppId);
                fetchPullRequestStats(selectedAppId);
            }
        });

        $('#gitanalysis-tab').on('shown.bs.tab', function() {
            fetchAppInfoDropdown();
        });
    });
</script>